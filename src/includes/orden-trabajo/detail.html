<div x-data="{ 
    markAll(type) {
        this.$dispatch('mark-all', { type: type });
    }
}" class="space-y-6 pb-24">

    <!-- Top Bar with Back Button and ID -->
    <div
        class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8 sticky top-0 z-10 bg-gray-50/80 dark:bg-gray-900/80 backdrop-blur-md py-4 transition-all">
        <button @click="view = 'list'"
            class="w-fit flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-200 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition shadow-sm shrink-0">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path>
            </svg>
            <span class="text-sm">Atr√°s</span>
        </button>

        <div class="flex flex-col sm:items-end flex-1 min-w-0">
            <span class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]"
                x-text="selectedWorkOrder.code"></span>
            <span class="text-xs font-bold text-brand-500 wrap-break-word line-clamp-2 sm:text-right"
                x-text="selectedWorkOrder.customer"></span>
        </div>
    </div>

    <!-- Header / Control Center -->
    <div
        class="bg-white dark:bg-gray-800 rounded-4xl p-8 border border-gray-100 dark:border-gray-700 shadow-xl shadow-brand-500/5 relative overflow-hidden">
        <!-- Abstract Background Shape -->
        <div class="absolute top-0 right-0 -mr-16 -mt-16 w-48 h-48 bg-brand-500/5 rounded-full blur-3xl"></div>

        <div class="flex flex-col items-center text-center space-y-6">
            <template x-if="!selectedWorkOrder.isStarted">
                <button @click="showOperatorSignatureModal = true"
                    class="w-full max-w-sm py-4 bg-brand-500 hover:bg-brand-600 active:scale-95 text-white text-lg font-bold rounded-xl shadow-2xl shadow-brand-500/30 transition-all duration-300 uppercase tracking-widest">
                    EMPEZAR
                </button>
            </template>

            <template x-if="selectedWorkOrder.isStarted">
                <div class="py-4">
                    <div class="inline-flex items-center gap-2 px-6 py-3 bg-brand-500/10 text-brand-500 rounded-full">
                        <span class="relative flex h-3 w-3">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-brand-500"></span>
                        </span>
                        <span class="text-lg font-black uppercase tracking-widest">Servicio Iniciado</span>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Services Section -->
    <div
        class="bg-white dark:bg-gray-800 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-xl overflow-hidden">
        <div class="p-6 md:p-8 bg-gray-50/50 dark:bg-gray-900/20 border-b border-gray-100 dark:border-gray-700">
            <h2 class="text-xl font-extrabold text-brand-900 dark:text-white text-center">Servicios</h2>
        </div>

        <div class="p-4 md:p-8 space-y-8">
            <!-- Services Cards -->
            <div class="grid grid-cols-1 gap-8">
                <template x-for="service in selectedWorkOrder.services" :key="service.id">
                    <div class="relative border border-gray-100 dark:border-gray-700 rounded-3xl p-4 md:p-6 transition-all duration-300 hover:shadow-lg"
                        x-data="{ interior: false, exterior: false }"
                        @mark-all.window="interior = ($event.detail.type === 'check'); exterior = ($event.detail.type === 'check')">
                        <div class="flex flex-col md:flex-row gap-6">
                            <!-- Image -->
                            <div
                                class="relative w-full md:w-56 h-40 rounded-2xl overflow-hidden shrink-0 shadow-inner group">
                                <img :src="service.image"
                                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" />
                                <button @click="infoModalData = service; showInfoModal = true"
                                    class="absolute bottom-3 right-3 p-2 bg-orange-500 text-white rounded-full shadow-lg hover:scale-110 transition-all active:scale-95">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>

                            <!-- Content -->
                            <div class="flex-1">
                                <h3 class="text-lg font-extrabold text-gray-900 dark:text-white mb-1"
                                    x-text="service.name"></h3>
                                <p
                                    class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-4 uppercase tracking-widest">
                                    Frequencia: <span x-text="service.frequency"></span></p>

                                <div class="relative text-center mb-4">
                                    <span
                                        class="absolute inset-x-0 top-1/2 h-px bg-gray-100 dark:bg-gray-700 -translate-y-1/2"></span>
                                    <span
                                        class="relative bg-white dark:bg-gray-800 px-3 text-[10px] font-black text-gray-400 uppercase tracking-widest">Cristal</span>
                                </div>

                                <!-- Toggle Controls -->
                                <div class="grid grid-cols-2 gap-4">
                                    <!-- Interior -->
                                    <div
                                        class="flex flex-col items-center gap-2 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-2xl border border-gray-100 dark:border-gray-700">
                                        <p
                                            class="text-[10px] font-black text-gray-400 uppercase tracking-widest leading-none">
                                            Interior</p>
                                        <p class="text-[10px] font-bold text-gray-600 dark:text-gray-300">F. Prevista:
                                            <span x-text="service.plannedDate"></span>
                                        </p>
                                        <button @click="interior = !interior"
                                            class="w-10 h-10 rounded-full border-4 flex items-center justify-center transition-all duration-300"
                                            :class="interior ? 'bg-red-500 border-red-200' : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-transparent'">
                                            <svg class="w-5 h-5 text-white" :class="interior ? 'block' : 'hidden'"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4"
                                                    d="M5 13l4 4L19 7" />
                                            </svg>
                                        </button>
                                    </div>

                                    <!-- Exterior -->
                                    <div
                                        class="flex flex-col items-center gap-2 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-2xl border border-gray-100 dark:border-gray-700">
                                        <p
                                            class="text-[10px] font-black text-gray-400 uppercase tracking-widest leading-none">
                                            Exterior</p>
                                        <p class="text-[10px] font-bold text-gray-600 dark:text-gray-300">F. Prevista:
                                            <span x-text="service.plannedDate"></span>
                                        </p>
                                        <button @click="exterior = !exterior"
                                            class="w-10 h-10 rounded-full border-4 flex items-center justify-center transition-all duration-300"
                                            :class="exterior ? 'bg-orange-500 border-orange-200' : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-transparent'">
                                            <svg class="w-5 h-5 text-white" :class="exterior ? 'block' : 'hidden'"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4"
                                                    d="M5 13l4 4L19 7" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Bulk Actions -->
            <div class="flex flex-col sm:flex-row gap-4 pt-4 border-t border-gray-100 dark:border-gray-700">
                <button @click="markAll('check')"
                    class="flex-1 py-3.5 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl shadow-lg shadow-green-500/20 transition-all active:scale-95 flex items-center justify-center gap-2 uppercase tracking-widest text-[10px]">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                            clip-rule="evenodd" />
                    </svg>
                    <span>Marcar todo</span>
                </button>
                <button @click="markAll('uncheck')"
                    class="flex-1 py-3.5 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl shadow-lg shadow-red-500/20 transition-all active:scale-95 flex items-center justify-center gap-2 uppercase tracking-widest text-[10px]">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z"
                            clip-rule="evenodd" />
                    </svg>
                    <span>Desmarcar todo</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Finalize Button -->
    <div class="mt-8 flex justify-center">
        <button @click="showSignatureModal = true" :disabled="!selectedWorkOrder.isStarted"
            class="w-full max-w-sm py-4 text-white text-lg font-bold rounded-xl shadow-2xl transition-all duration-300 flex items-center justify-center gap-4 group disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-widest"
            :class="selectedWorkOrder.isStarted ? 'bg-brand-500 hover:bg-brand-600 shadow-brand-500/40' : 'bg-gray-400 shadow-none'">
            <span>Terminar</span>
        </button>
    </div>
</div>